# This file was generated by AI and is not subject to copyright protection.
# It is dedicated to the public domain.

# CMakeLists.txt for the Ananbox standalone server

option(BUILD_ANANBOX_SERVER "Build the standalone Ananbox server" OFF)

if(BUILD_ANANBOX_SERVER)
    # For standalone server, we need proot built for native Linux
    if(NOT ANDROID)
        include(${CMAKE_CURRENT_SOURCE_DIR}/../../cmake/ProotNative.cmake)
    endif()

    set(SERVER_SOURCES
        server/streaming_protocol.h
        server/streaming_server.h
        server/streaming_server.cpp
        server/main.cpp
    )

    add_executable(ananbox-server ${SERVER_SOURCES})
    
    target_include_directories(ananbox-server PRIVATE
        ${CMAKE_CURRENT_SOURCE_DIR}
        ${CMAKE_CURRENT_SOURCE_DIR}/anbox
        ${Boost_INCLUDE_DIRS}
    )
    
    target_link_libraries(ananbox-server
        anbox-core
        ${Boost_LIBRARIES}
        pthread
    )
    
    # Add dependency on proot for native builds
    if(NOT ANDROID AND TARGET proot-native)
        add_dependencies(ananbox-server proot-native)
    endif()

    # Install the server binary
    install(TARGETS ananbox-server DESTINATION bin)
    
    # Install proot alongside the server
    if(NOT ANDROID AND EXISTS ${PROOT_BINARY})
        install(PROGRAMS ${PROOT_BINARY} DESTINATION bin)
    endif()
endif()
