# This file was generated by AI and is not subject to copyright protection.
# It is dedicated to the public domain.

# CMakeLists.txt for the Ananbox standalone server (for Termux)
# This builds the server and proot for running in Termux on Android devices

option(BUILD_ANANBOX_SERVER "Build the standalone Ananbox server for Termux" OFF)

if(BUILD_ANANBOX_SERVER)
    if(NOT ANDROID)
        message(FATAL_ERROR "The standalone server is designed for Termux (Android). Please use the Android NDK toolchain.")
    endif()
    
    # proot is already built by the main CMakeLists.txt via cmake/Proot.cmake
    # We just need to build the server and depend on the existing proot target

    set(SERVER_SOURCES
        ${CMAKE_CURRENT_SOURCE_DIR}/streaming_server.cpp
        ${CMAKE_CURRENT_SOURCE_DIR}/main.cpp
    )

    add_executable(ananbox-server ${SERVER_SOURCES})
    
    target_include_directories(ananbox-server PRIVATE
        ${CMAKE_CURRENT_SOURCE_DIR}
        ${CMAKE_CURRENT_SOURCE_DIR}/..
        ${CMAKE_CURRENT_SOURCE_DIR}/../anbox
        ${Boost_INCLUDE_DIRS}
    )
    
    target_link_libraries(ananbox-server
        anbox-core
        ${Boost_LIBRARIES}
        log
        android
        EGL
        GLESv2
    )
    
    # Add dependency on the existing proot target from cmake/Proot.cmake
    if(TARGET proot)
        add_dependencies(ananbox-server proot)
    endif()

    # Install the server binary
    install(TARGETS ananbox-server DESTINATION bin)
    
    # proot binary is already built to CMAKE_LIBRARY_OUTPUT_DIRECTORY/libproot.so
    # by the main build system
endif()
